/*******************************************************************************
 * Copyright (c) 2017 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
_MF_CLS(_PFX_XHR+"engine.IFrame",myfaces._impl.xhrCore.engine.BaseRequest,{_finalized:false,_frame:null,_aborted:false,CLS_NAME:"myfaces._impl.xhrCore._IFrameRequest",_FRAME_ID:"_mf_comm_frm",constructor_:function(A){this._callSuper("constructor",A);this._initDefaultFinalizableFields();this._XHRConst=myfaces._impl.xhrCore.engine.XhrConst;this._Lang.applyArgs(this,A);this.readyState=this._XHRConst.READY_STATE_UNSENT;this._startTimeout();},setRequestHeader:function(A,B){},open:function(F,A,C){this.readyState=this._XHRConst.READY_STATE_OPENED;var E=myfaces._impl.core._Runtime;var B=this._Lang;this._frame=this._createTransportFrame();if(!E.browser.isIE||this._Dom.isDomCompliant()){this._frame.onload=B.hitch(this,this._callback);}else{this._frame.onload_IE=B.hitch(this,this._callback);}this.method=F||this.method;this.url=A||this.url;this.async=("undefined"!=typeof C)?C:this.async;var D={};this._addProgressAttributes(D,10,100);this.onprogress(D);},send:function(D){var B={};this._addProgressAttributes(B,20,100);this.onloadstart(B);this.onprogress(B);var F=D.form,C=F.target,E=F.method,A=F.action;try{F.target=this._frame.name;F.method=this.method;if(this.url){F.action=this.url;}this.readyState=this._XHRConst.READY_STATE_LOADING;this.onreadystatechange(B);F.submit();}finally{F.action=A;F.target=C;F.method=E;D._finalize();this._finalized=true;}},abort:function(){this._aborted=true;this.onabort({});},_addProgressAttributes:function(A,C,B){A.lengthComputable=true;A.loaded=C;A.total=B;},_callback:function(){if(this._aborted){return ;}if(this._timeoutTimer){clearTimeout(this._timeoutTimer);}if(!this._finalized){setTimeout(this._Lang.hitch(this,this._callback),10);return ;}try{var A={};this._addProgressAttributes(A,100,100);this.responseText=this._getFrameText();this.responseXML=this._getFrameXml();this.readyState=this._XHRConst.READY_STATE_DONE;this.onreadystatechange(A);this.onloadend();if(!this._Lang.isXMLParseError(this.responseXML)){this.status=201;this.onload();}else{this.status=0;this.onerror();}}finally{this._frame=null;}},_getFrameDocument:function(){return this._frame.contentWindow.document||this._frame.contentDocument||this._frame.document;},_getFrameText:function(){var B=this._getFrameDocument();var A=B.body||B.documentElement;return A.innerHTML;},_clearFrame:function(){var B=this._getFrameDocument();var A=B.documentElement||B.body;if(myfaces._impl.core._Runtime.browser.isIE){this._Dom._removeChildNodes(A,false);}else{A.innerHTML="";}},_getFrameXml:function(){var A=this._getFrameDocument();return A.XMLDocument||A;},_createTransportFrame:function(){var B=this._FRAME_ID;var D=document.getElementById(B);if(D){return D;}if(this._Dom.isDomCompliant()){D=this._Dom.createElement("iframe",{"src":"about:blank","id":B,"name":B,"type":"content","collapsed":"true","style":"display:none"});document.body.appendChild(D);}else{var C=this._Dom.createElement("div",{"style":"display:none"});C.innerHTML="<iframe id='"+B+"' name='"+B+"' style='display:none;' src='about:blank' type='content' onload='this.onload_IE();'  ></iframe>";var A=document.body;if(A.firstChild){A.insertBefore(C,document.body.firstChild);}else{A.appendChild(C);}}return document.getElementById(B);},_startTimeout:function(){if(this.timeout==0){return ;}this._timeoutTimer=setTimeout(this._Lang.hitch(this,function(){if(this._xhrObject.readyState!=this._XHRConst.READY_STATE_DONE){this._aborted=true;clearTimeout(this._timeoutTimer);this.ontimeout({});this._timeoutTimer=null;}}),this.timeout);}});
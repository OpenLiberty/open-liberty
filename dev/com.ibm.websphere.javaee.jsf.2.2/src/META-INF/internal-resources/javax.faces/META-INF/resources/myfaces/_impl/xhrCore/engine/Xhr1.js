/*******************************************************************************
 * Copyright (c) 2017 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
_MF_CLS(_PFX_XHR+"engine.Xhr1",myfaces._impl.xhrCore.engine.BaseRequest,{_xhrObject:null,_timeoutTimer:null,constructor_:function(A){this._callSuper("constructor_",A);this._initDefaultFinalizableFields();this._XHRConst=myfaces._impl.xhrCore.engine.XhrConst;this._Lang.applyArgs(this,A);},open:function(D,A,B){var C=this._xhrObject;C.onreadystatechange=this._Lang.hitch(this,this.onreadystatechange);this.method=D||this.method;this.url=A||this.url;this.async=("undefined"!=typeof B)?B:this.async;C.open(this.method,this.url,this.async);},send:function(B){var A={};this._addProgressAttributes(A,20,100);this.onloadstart(A);this.onprogress(A);this._startTimeout();this._xhrObject.send(B);},setRequestHeader:function(A,B){this._xhrObject.setRequestHeader(A,B);},abort:function(){this._xhrObject.abort();this.onabort({});},_addProgressAttributes:function(A,C,B){A.lengthComputable=true;A.loaded=C;A.total=B;},onreadystatechange:function(B){var C=B||{};var F=this._xhrObject;var E=this._XHRConst;try{this.readyState=F.readyState;this.status=""+F.status;}catch(D){}switch(this.readyState){case E.READY_STATE_OPENED:this._addProgressAttributes(C,10,100);this.onprogress(C);break;case E.READY_STATE_HEADERS_RECEIVED:this._addProgressAttributes(C,25,100);this.onprogress(C);break;case E.READY_STATE_LOADING:if(this._loadingCalled){break;}this._loadingCalled=true;this._addProgressAttributes(C,50,100);this.onprogress(C);break;case E.READY_STATE_DONE:this._addProgressAttributes(C,100,100);if(this._timeoutTimer){window.clearTimeout(this._timeoutTimer);this._timeoutTimer=null;}this._transferRequestValues();this.onprogress(C);try{var A=F.status;if(A>=E.STATUS_OK_MINOR&&A<E.STATUS_OK_MAJOR){this.onload(C);}else{C.type="error";this.onerror(C);}}finally{this.onloadend(C);}}},_transferRequestValues:function(){var A="undefined";var B=this._xhrObject;this.responseText=(A!=typeof B.responseText)?B.responseText:null;this.responseXML=(A!=typeof B.responseXML)?B.responseXML:null;this.status=(A!=typeof B.status)?B.status:null;this.statusText=(A!=typeof B.statusText)?B.statusText:null;this.response=(A!=typeof B.response)?B.response:null;},_startTimeout:function(){if(this.timeout==0){return ;}var B=this._xhrObject;try{if("undefined"!=typeof B.timeout){B.timeout=this.timeout;B.ontimeout=this.ontimeout;return ;}}catch(A){}this._timeoutTimer=setTimeout(this._Lang.hitch(this,function(){if(B.readyState!=this._XHRConst.READY_STATE_DONE){B.onreadystatechange=function(){};clearTimeout(this._timeoutTimer);B.abort();this.ontimeout({});}}),this.timeout);},getXHRObject:function(){return this._xhrObject;}});
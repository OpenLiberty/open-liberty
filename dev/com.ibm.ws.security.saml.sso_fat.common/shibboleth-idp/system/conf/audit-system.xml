<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:util="http://www.springframework.org/schema/util" xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:c="http://www.springframework.org/schema/c" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"

	   default-init-method="initialize"
       default-destroy-method="destroy">
    
    <bean id="shibboleth.DefaultSuppressedEvents" lazy-init="true"
            class="org.springframework.beans.factory.config.ListFactoryBean">
        <property name="sourceList">
            <list>
                <value>NoPotentialFlow</value>
                <value>AttributeReleaseRejected</value>
                <value>TermsRejected</value>
                <value>ContextCheckDenied</value>
            </list>
        </property>
    </bean>
    
    <!-- Controls which profiles get audited. -->
    <bean id="shibboleth.ProfileAuditingCondition" class="com.google.common.base.Predicates" factory-method="not">
        <constructor-arg>
            <bean class="net.shibboleth.utilities.java.support.logic.StrategyIndirectedPredicate">
                <constructor-arg name="objectStrategy">
                    <bean class="org.opensaml.profile.context.navigate.ProfileIdLookup" />
                </constructor-arg>
                <constructor-arg name="collection">
                    <ref bean="shibboleth.AuditSuppressedProfiles" />
                </constructor-arg>
            </bean>
        </constructor-arg>
    </bean>
    
    <!-- Reusable bean for extracting a username and hashing it for F-TICKS. -->
    <bean id="shibboleth.UsernameHasher" class="com.google.common.base.Functions" factory-method="compose">
        <constructor-arg name="g">
            <bean class="net.shibboleth.utilities.java.support.codec.StringDigester"
                c:algorithm="#{'%{idp.fticks.algorithm:SHA-256}'.trim()}" c:format="HEX_LOWER"
                p:salt="%{idp.fticks.salt:}" p:requireSalt="true" />
        </constructor-arg>
        <constructor-arg name="f">
            <bean class="com.google.common.base.Functions" factory-method="compose">
                <constructor-arg name="g">
                    <bean class="net.shibboleth.idp.authn.context.navigate.SubjectContextPrincipalLookupFunction" />
                </constructor-arg>
                <constructor-arg name="f">
                    <ref bean="shibboleth.ChildLookup.SubjectContext" />
                </constructor-arg>
            </bean>
        </constructor-arg>
    </bean>
    
    <!--
    The actual beans used are in user-space, but they inherit from the maps below. We have to use a
    MapFactoryBean instead of util:map because merging isn't supported by the util:map schema.
    -->
    <import resource="../../conf/audit.xml"/>

    <bean id="shibboleth.DefaultPostDecodeAuditExtractors" lazy-init="true"
            class="org.springframework.beans.factory.config.MapFactoryBean">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.PROTOCOL"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="constant"
                        c:value-ref="shibboleth.MetadataLookup.Protocol" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.REQUEST_BINDING"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="org.opensaml.saml.common.messaging.context.navigate.SAMLBindingContextBindingFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookup.SAMLBindingContext"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.REQUEST_ID"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="org.opensaml.saml.common.messaging.context.navigate.SAMLMessageInfoContextIDFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookupOrCreate.SAMLMessageInfoContext"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.REQUEST_ISSUE_INSTANT"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="org.opensaml.saml.common.messaging.context.navigate.SAMLMessageInfoContextIssueInstantFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookupOrCreate.SAMLMessageInfoContext"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.IN_RESPONSE_TO"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.InResponseToAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.STATUS_CODE"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.StatusCodeAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.SUBSTATUS_CODE"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.SubStatusCodeAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.STATUS_MESSAGE"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.StatusMessageAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.IS_PASSIVE"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.IsPassiveAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.AuthnRequest"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.FORCE_AUTHN"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.ForceAuthnAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.AuthnRequest"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>
        
    <bean id="shibboleth.DefaultPostLookupAuditExtractors"
            class="org.springframework.beans.factory.config.MapFactoryBean">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.SERVICE_PROVIDER"/>
                    </key>
                    <ref bean="shibboleth.RelyingPartyIdLookup.Simple" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.IDENTITY_PROVIDER"/>
                    </key>
                    <ref bean="shibboleth.ResponderIdLookup.Simple" />
                </entry>
            </map>
        </property>
    </bean>
    
    <bean id="shibboleth.DefaultPostAssertionAuditExtractors"
            class="org.springframework.beans.factory.config.MapFactoryBean">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.ASSERTION_ID"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.AssertionIDAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.ASSERTION_ISSUE_INSTANT"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.AssertionInstantAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.AUTHN_INSTANT"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.AuthnInstantAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.SESSION_INDEX"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.SessionIndexAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.AUTHN_CONTEXT"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.AuthnContextAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.NAMEID"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.NameIDAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.NAMEID_FORMAT"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.NameIDFormatAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>
        
    <bean id="shibboleth.DefaultPostResponseAuditExtractors"
            class="org.springframework.beans.factory.config.MapFactoryBean">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.authn.AuthnAuditFields.AUTHN_FLOW_ID"/>
                    </key>
                    <bean class="net.shibboleth.idp.authn.audit.impl.AuthenticationFlowAuditExtractor" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.authn.AuthnAuditFields.SSO"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="net.shibboleth.idp.authn.context.navigate.PreviousResultLookupFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <ref bean="shibboleth.ChildLookup.AuthenticationContext" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.USERNAME"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose"
                        c:g-ref="shibboleth.PrincipalNameLookup.Subject"
                        c:f-ref="shibboleth.ChildLookup.SubjectContext" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.HASHED_USERNAME"/>
                    </key>
                    <ref bean="shibboleth.UsernameHasher" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.SESSION_ID"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="net.shibboleth.idp.session.context.navigate.SessionContextIDLookupFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <ref bean="shibboleth.ChildLookup.SessionContext" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.ATTRIBUTES"/>
                    </key>
                    <bean class="net.shibboleth.idp.profile.audit.impl.AttributesAuditExtractor">
                        <property name="activationCondition">
                            <bean parent="shibboleth.Conditions.OR">
                                <constructor-arg>
                                    <list>
                                        <bean parent="shibboleth.Conditions.Expression"
                                            c:_0="#profileContext.getProfileId().equals('http://shibboleth.net/ns/profiles/resolvertest')" />
                                        <bean class="net.shibboleth.idp.saml.profile.config.logic.IncludeAttributeStatementPredicate" />
                                    </list>
                                </constructor-arg>
                            </bean>
                        </property>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.RESPONSE_BINDING"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="org.opensaml.saml.common.messaging.context.navigate.SAMLBindingContextBindingFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookup.SAMLBindingContext"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.RESPONSE_ID"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="org.opensaml.saml.common.messaging.context.navigate.SAMLMessageInfoContextIDFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookupOrCreate.SAMLMessageInfoContext"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.RESPONSE_ISSUE_INSTANT"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="org.opensaml.saml.common.messaging.context.navigate.SAMLMessageInfoContextIssueInstantFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookupOrCreate.SAMLMessageInfoContext"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.IN_RESPONSE_TO"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.InResponseToAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.STATUS_CODE"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.StatusCodeAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.SUBSTATUS_CODE"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.SubStatusCodeAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.STATUS_MESSAGE"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.StatusMessageAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>
    
    <bean id="shibboleth.DefaultLogoutRequestAuditExtractors"
            class="org.springframework.beans.factory.config.MapFactoryBean">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.NAMEID"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.NameIDAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.NAMEID_FORMAT"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.NameIDFormatAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.SESSION_INDEX"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.SessionIndexAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>
    
    <bean id="shibboleth.DefaultLogoutAuditExtractors"
            class="org.springframework.beans.factory.config.MapFactoryBean">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.USERNAME"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose"
                        c:g-ref="shibboleth.PrincipalNameLookup.Subject"
                        c:f-ref="shibboleth.ChildLookup.SubjectContext" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.HASHED_USERNAME"/>
                    </key>
                    <ref bean="shibboleth.UsernameHasher" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.SESSION_ID"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="net.shibboleth.idp.session.context.navigate.SessionContextIDLookupFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <ref bean="shibboleth.ChildLookup.SessionContext" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.NAMEID"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.NameIDAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>
        
    <bean id="shibboleth.DefaultErrorViewAuditExtractors"
            class="org.springframework.beans.factory.config.MapFactoryBean">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.authn.AuthnAuditFields.AUTHN_FLOW_ID"/>
                    </key>
                    <bean class="net.shibboleth.idp.authn.audit.impl.AuthenticationFlowAuditExtractor" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.authn.AuthnAuditFields.SSO"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="net.shibboleth.idp.authn.context.navigate.PreviousResultLookupFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <ref bean="shibboleth.ChildLookup.AuthenticationContext" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.USERNAME"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose"
                        c:g-ref="shibboleth.PrincipalNameLookup.Subject"
                        c:f-ref="shibboleth.ChildLookup.SubjectContext" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.HASHED_USERNAME"/>
                    </key>
                    <ref bean="shibboleth.UsernameHasher" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.SESSION_ID"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="net.shibboleth.idp.session.context.navigate.SessionContextIDLookupFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <ref bean="shibboleth.ChildLookup.SessionContext" />
                        </constructor-arg>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="shibboleth.DefaultCASLoginAuditExtractors"
          class="org.springframework.beans.factory.config.MapFactoryBean">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.authn.AuthnAuditFields.AUTHN_FLOW_ID"/>
                    </key>
                    <bean class="net.shibboleth.idp.authn.audit.impl.AuthenticationFlowAuditExtractor" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.authn.AuthnAuditFields.SSO"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="net.shibboleth.idp.authn.context.navigate.PreviousResultLookupFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <ref bean="shibboleth.ChildLookup.AuthenticationContext" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.USERNAME"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose"
                          c:g-ref="shibboleth.PrincipalNameLookup.Subject"
                          c:f-ref="shibboleth.ChildLookup.SubjectContext" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.HASHED_USERNAME"/>
                    </key>
                    <ref bean="shibboleth.UsernameHasher" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.cas.protocol.CASAuditFields.USER"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose"
                          c:g-ref="shibboleth.PrincipalNameLookup.Subject"
                          c:f-ref="shibboleth.ChildLookup.SubjectContext" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.cas.protocol.CASAuditFields.SERVICE_URL"/>
                    </key>
                    <bean class="net.shibboleth.idp.cas.audit.impl.ServiceLookupFunction" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.cas.protocol.CASAuditFields.GATEWAY"/>
                    </key>
                    <bean class="net.shibboleth.idp.cas.audit.impl.GatewayLookupFunction" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.cas.protocol.CASAuditFields.RENEW"/>
                    </key>
                    <bean class="net.shibboleth.idp.cas.audit.impl.RenewLookupFunction" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.SESSION_ID"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="net.shibboleth.idp.session.context.navigate.SessionContextIDLookupFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <ref bean="shibboleth.ChildLookup.SessionContext" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.cas.protocol.CASAuditFields.SERVICE_TICKET"/>
                    </key>
                    <bean class="net.shibboleth.idp.cas.audit.impl.TicketLookupFunction" />
                </entry>
            </map>
        </property>
    </bean>

    <bean id="shibboleth.DefaultCASValidationAuditExtractors"
          class="org.springframework.beans.factory.config.MapFactoryBean">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.USERNAME"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose"
                          c:g-ref="shibboleth.PrincipalNameLookup.Subject"
                          c:f-ref="shibboleth.ChildLookup.SubjectContext" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.HASHED_USERNAME"/>
                    </key>
                    <ref bean="shibboleth.UsernameHasher" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.cas.protocol.CASAuditFields.USER"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose"
                          c:g-ref="shibboleth.PrincipalNameLookup.Subject"
                          c:f-ref="shibboleth.ChildLookup.SubjectContext" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.cas.protocol.CASAuditFields.SERVICE_URL"/>
                    </key>
                    <bean class="net.shibboleth.idp.cas.audit.impl.ServiceLookupFunction" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.SESSION_ID"/>
                    </key>
                    <bean class="com.google.common.base.Functions" factory-method="compose">
                        <constructor-arg name="g">
                            <bean class="net.shibboleth.idp.session.context.navigate.SessionContextIDLookupFunction" />
                        </constructor-arg>
                        <constructor-arg name="f">
                            <ref bean="shibboleth.ChildLookup.SessionContext" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.cas.protocol.CASAuditFields.SERVICE_TICKET"/>
                    </key>
                    <bean class="net.shibboleth.idp.cas.audit.impl.TicketLookupFunction" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.cas.protocol.CASAuditFields.STATUS_CODE"/>
                    </key>
                    <bean class="net.shibboleth.idp.cas.audit.impl.StatusCodeLookupFunction" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.cas.protocol.CASAuditFields.STATUS_DETAIL"/>
                    </key>
                    <bean class="net.shibboleth.idp.cas.audit.impl.StatusDetailLookupFunction" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.profile.IdPAuditFields.ATTRIBUTES"/>
                    </key>
                    <bean class="net.shibboleth.idp.profile.audit.impl.AttributesAuditExtractor" />
                </entry>
            </map>
        </property>
    </bean>

    <bean id="shibboleth.DefaultCASProxyAuditExtractors"
          class="org.springframework.beans.factory.config.MapFactoryBean"
          parent="shibboleth.DefaultCASValidationAuditExtractors">
        <property name="sourceMap">
            <map merge="true">
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.cas.protocol.CASAuditFields.GRANTING_TICKET"/>
                    </key>
                    <bean class="net.shibboleth.idp.cas.audit.impl.ProxyGrantingTicketLookupFunction" />
                </entry>
            </map>
        </property>
    </bean>
    
</beans>
